<!DOCTYPE html><html class="default"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="IE=edge"/><title>xray-well</title><meta name="description" content="Documentation for xray-well"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="assets/style.css"/><link rel="stylesheet" href="assets/highlight.css"/><script async src="assets/search.js" id="search-script"></script></head><body><script>document.body.classList.add(localStorage.getItem("tsd-theme") || "os")</script><header><div class="tsd-page-toolbar"><div class="container"><div class="table-wrap"><div class="table-cell" id="tsd-search" data-base="."><div class="field"><label for="tsd-search-field" class="tsd-widget search no-caption">Search</label><input type="text" id="tsd-search-field"/></div><ul class="results"><li class="state loading">Preparing search index...</li><li class="state failure">The search index is not available</li></ul><a href="index.html" class="title">xray-well</a></div><div class="table-cell" id="tsd-widgets"><div id="tsd-filter"><a href="#" class="tsd-widget options no-caption" data-toggle="options">Options</a><div class="tsd-filter-group"><div class="tsd-select" id="tsd-filter-visibility"><span class="tsd-select-label">All</span><ul class="tsd-select-list"><li data-value="public">Public</li><li data-value="protected">Public/Protected</li><li data-value="private" class="selected">All</li></ul></div> <input type="checkbox" id="tsd-filter-inherited" checked/><label class="tsd-widget" for="tsd-filter-inherited">Inherited</label><input type="checkbox" id="tsd-filter-externals" checked/><label class="tsd-widget" for="tsd-filter-externals">Externals</label></div></div><a href="#" class="tsd-widget menu no-caption" data-toggle="menu">Menu</a></div></div></div></div><div class="tsd-page-title"><div class="container"><h1>xray-well</h1></div></div></header><div class="container container-main"><div class="row"><div class="col-8 col-content"><div class="tsd-panel tsd-typography">
<a href="#aws-x-ray-well---an-unofficial-sdk-for-nodejs" id="aws-x-ray-well---an-unofficial-sdk-for-nodejs" style="color: inherit; text-decoration: none;">
  <h1>AWS X-Ray Well - An Unofficial SDK for Node.js</h1>
</a>
<blockquote>
<p>Simple way to use AWS X-Ray. This is a jerry-rig free X-Ray SDK.</p>
</blockquote>
<p><img src="https://github.com/felipefdl/xray-well/workflows/X-Ray%20Well%20Tests/badge.svg?branch=master" alt="X-Ray Well Tests">
<img src="https://img.shields.io/github/license/felipefdl/xray-well?style=flat-square" alt="GitHub">
<img src="https://img.shields.io/node/v/xray-well?style=flat-square" alt="node-current">
<img src="https://img.shields.io/npm/dm/xray-well?style=flat-square" alt="npm">
<img src="https://img.shields.io/npm/v/xray-well?color=green&style=flat-square" alt="npm"></p>
<p><a href="https://felipefdl.github.io/xray-well/">Documentation</a></p>

<a href="#why" id="why" style="color: inherit; text-decoration: none;">
  <h2>Why?</h2>
</a>
<p>The Official AWS SDK X-Ray wraps the native node modules to try to make it like magic, but it&#39;s a bad idea when trying to use it in complex systems. I tried to use the official SDK for more than 5 times in the past and it always not work to me, sometimes the problem is because I use it in a framework not supported as Koa, some times even on express (supported framework by AWS SDK) it not work well.</p>
<p>So, I created this lib well done, this lib will never auto attach on Node.js native modules, it does not work like magic, but you can do your magic using it.</p>

<a href="#how-to-install-it" id="how-to-install-it" style="color: inherit; text-decoration: none;">
  <h2>How to install it?</h2>
</a>
<pre><code class="language-bash"><span class="hl-0">$ npm install xray-well --save</span>
</code></pre>
<blockquote>
<p>Set the configuration on main file of your application. You still need the AWS X-Ray Daemon</p>
</blockquote>
<pre><code class="language-javascript"><span class="hl-1">const</span><span class="hl-0"> </span><span class="hl-2">xrayWell</span><span class="hl-0"> = </span><span class="hl-3">require</span><span class="hl-0">(</span><span class="hl-4">&quot;xray-well&quot;</span><span class="hl-0">);</span><br/><span class="hl-5">xrayWell</span><span class="hl-0">.</span><span class="hl-3">setConfig</span><span class="hl-0">({ </span><span class="hl-5">server:</span><span class="hl-0"> </span><span class="hl-4">&quot;localhost&quot;</span><span class="hl-0">, </span><span class="hl-5">port:</span><span class="hl-0"> </span><span class="hl-6">2000</span><span class="hl-0"> });</span>
</code></pre>

<a href="#how-to-use-on-express-framework" id="how-to-use-on-express-framework" style="color: inherit; text-decoration: none;">
  <h2>How to use on Express Framework?</h2>
</a>
<pre><code class="language-javascript"><span class="hl-1">const</span><span class="hl-0"> </span><span class="hl-2">xrayWell</span><span class="hl-0"> = </span><span class="hl-3">require</span><span class="hl-0">(</span><span class="hl-4">&quot;xray-well&quot;</span><span class="hl-0">);</span><br/><span class="hl-1">const</span><span class="hl-0"> </span><span class="hl-2">express</span><span class="hl-0">  = </span><span class="hl-3">require</span><span class="hl-0">(</span><span class="hl-4">&quot;express&quot;</span><span class="hl-0">);</span><br/><span class="hl-1">const</span><span class="hl-0"> </span><span class="hl-2">app</span><span class="hl-0">      = </span><span class="hl-3">express</span><span class="hl-0">();</span><br/><br/><span class="hl-5">app</span><span class="hl-0">.</span><span class="hl-3">use</span><span class="hl-0">(</span><span class="hl-5">xrayWell</span><span class="hl-0">.</span><span class="hl-5">middleware</span><span class="hl-0">.</span><span class="hl-3">express</span><span class="hl-0">({ </span><span class="hl-5">name:</span><span class="hl-0"> </span><span class="hl-4">&quot;my.awesome.domain.com&quot;</span><span class="hl-0"> })); </span><span class="hl-7">// Add it before any another middleware</span><br/><br/><span class="hl-5">app</span><span class="hl-0">.</span><span class="hl-3">get</span><span class="hl-0">(</span><span class="hl-4">&quot;/&quot;</span><span class="hl-0">, (</span><span class="hl-5">req</span><span class="hl-0">, </span><span class="hl-5">res</span><span class="hl-0">) </span><span class="hl-1">=&gt;</span><span class="hl-0"> {</span><br/><span class="hl-0">  </span><span class="hl-5">req</span><span class="hl-0">.</span><span class="hl-5">xray</span><span class="hl-0">.</span><span class="hl-3">setUser</span><span class="hl-0">(</span><span class="hl-4">&quot;user@email.com&quot;</span><span class="hl-0">);</span><br/><span class="hl-0">  </span><span class="hl-5">req</span><span class="hl-0">.</span><span class="hl-5">xray</span><span class="hl-0">.</span><span class="hl-3">addAnnotation</span><span class="hl-0">(</span><span class="hl-4">&quot;user_id&quot;</span><span class="hl-0">, </span><span class="hl-4">&quot;44232123&quot;</span><span class="hl-0">);</span><br/><span class="hl-0">  </span><span class="hl-5">req</span><span class="hl-0">.</span><span class="hl-5">xray</span><span class="hl-0">.</span><span class="hl-3">addAnnotation</span><span class="hl-0">(</span><span class="hl-4">&quot;company&quot;</span><span class="hl-0">, </span><span class="hl-4">&quot;acme&quot;</span><span class="hl-0">);</span><br/><span class="hl-0">  </span><span class="hl-5">req</span><span class="hl-0">.</span><span class="hl-5">xray</span><span class="hl-0">.</span><span class="hl-3">addMetadata</span><span class="hl-0">(</span><span class="hl-4">&quot;myNamespace&quot;</span><span class="hl-0">, </span><span class="hl-4">&quot;any&quot;</span><span class="hl-0">, </span><span class="hl-4">&quot;value&quot;</span><span class="hl-0">);</span><br/><span class="hl-0">  </span><span class="hl-5">req</span><span class="hl-0">.</span><span class="hl-5">xray</span><span class="hl-0">.</span><span class="hl-3">addMetadata</span><span class="hl-0">(</span><span class="hl-4">&quot;myNamespace&quot;</span><span class="hl-0">, </span><span class="hl-4">&quot;another&quot;</span><span class="hl-0">, </span><span class="hl-1">true</span><span class="hl-0">);</span><br/><span class="hl-0">  </span><span class="hl-5">req</span><span class="hl-0">.</span><span class="hl-5">xray</span><span class="hl-0">.</span><span class="hl-3">addMetadata</span><span class="hl-0">(</span><span class="hl-4">&quot;mySecondsNamespace&quot;</span><span class="hl-0">, </span><span class="hl-4">&quot;foo&quot;</span><span class="hl-0">, </span><span class="hl-4">&quot;bar&quot;</span><span class="hl-0">);</span><br/><br/><span class="hl-0">  </span><span class="hl-5">res</span><span class="hl-0">.</span><span class="hl-3">send</span><span class="hl-0">(</span><span class="hl-4">&quot;Hi AWS, I&#39;m not using your SDK! =)&quot;</span><span class="hl-0">);</span><br/><span class="hl-0">});</span><br/><br/><span class="hl-5">app</span><span class="hl-0">.</span><span class="hl-3">listen</span><span class="hl-0">(</span><span class="hl-6">3030</span><span class="hl-0">, () </span><span class="hl-1">=&gt;</span><span class="hl-0"> </span><span class="hl-5">console</span><span class="hl-0">.</span><span class="hl-3">log</span><span class="hl-0">(</span><span class="hl-4">&quot;Listening at http://localhost:3030&quot;</span><span class="hl-0">));</span><br/>
</code></pre>

<a href="#how-to-use-on-koa-framework" id="how-to-use-on-koa-framework" style="color: inherit; text-decoration: none;">
  <h2>How to use on Koa Framework?</h2>
</a>
<pre><code class="language-javascript"><span class="hl-1">const</span><span class="hl-0"> </span><span class="hl-2">xrayWell</span><span class="hl-0"> = </span><span class="hl-3">require</span><span class="hl-0">(</span><span class="hl-4">&quot;xray-well&quot;</span><span class="hl-0">);</span><br/><span class="hl-1">const</span><span class="hl-0"> </span><span class="hl-2">Koa</span><span class="hl-0">      = </span><span class="hl-3">require</span><span class="hl-0">(</span><span class="hl-4">&quot;koa&quot;</span><span class="hl-0">);</span><br/><span class="hl-1">const</span><span class="hl-0"> </span><span class="hl-2">app</span><span class="hl-0">      = </span><span class="hl-1">new</span><span class="hl-0"> </span><span class="hl-3">Koa</span><span class="hl-0">();</span><br/><br/><span class="hl-5">app</span><span class="hl-0">.</span><span class="hl-3">use</span><span class="hl-0">(</span><span class="hl-5">xrayWell</span><span class="hl-0">.</span><span class="hl-5">middleware</span><span class="hl-0">.</span><span class="hl-3">koa</span><span class="hl-0">({ </span><span class="hl-5">name:</span><span class="hl-0"> </span><span class="hl-4">&quot;my.awesome.domain.com&quot;</span><span class="hl-0"> })); </span><span class="hl-7">// Add it before any another middleware</span><br/><br/><span class="hl-5">app</span><span class="hl-0">.</span><span class="hl-3">use</span><span class="hl-0">((</span><span class="hl-5">ctx</span><span class="hl-0">) </span><span class="hl-1">=&gt;</span><span class="hl-0"> {</span><br/><span class="hl-0">  </span><span class="hl-5">ctx</span><span class="hl-0">.</span><span class="hl-5">xray</span><span class="hl-0">.</span><span class="hl-3">setUser</span><span class="hl-0">(</span><span class="hl-4">&quot;user@email.com&quot;</span><span class="hl-0">);</span><br/><span class="hl-0">  </span><span class="hl-5">ctx</span><span class="hl-0">.</span><span class="hl-5">xray</span><span class="hl-0">.</span><span class="hl-3">addAnnotation</span><span class="hl-0">(</span><span class="hl-4">&quot;user_id&quot;</span><span class="hl-0">, </span><span class="hl-4">&quot;44232123&quot;</span><span class="hl-0">);</span><br/><span class="hl-0">  </span><span class="hl-5">ctx</span><span class="hl-0">.</span><span class="hl-5">xray</span><span class="hl-0">.</span><span class="hl-3">addAnnotation</span><span class="hl-0">(</span><span class="hl-4">&quot;company&quot;</span><span class="hl-0">, </span><span class="hl-4">&quot;acme&quot;</span><span class="hl-0">);</span><br/><span class="hl-0">  </span><span class="hl-5">ctx</span><span class="hl-0">.</span><span class="hl-5">xray</span><span class="hl-0">.</span><span class="hl-3">addMetadata</span><span class="hl-0">(</span><span class="hl-4">&quot;myNamespace&quot;</span><span class="hl-0">, </span><span class="hl-4">&quot;any&quot;</span><span class="hl-0">, </span><span class="hl-4">&quot;value&quot;</span><span class="hl-0">);</span><br/><span class="hl-0">  </span><span class="hl-5">ctx</span><span class="hl-0">.</span><span class="hl-5">xray</span><span class="hl-0">.</span><span class="hl-3">addMetadata</span><span class="hl-0">(</span><span class="hl-4">&quot;myNamespace&quot;</span><span class="hl-0">, </span><span class="hl-4">&quot;another&quot;</span><span class="hl-0">, </span><span class="hl-1">true</span><span class="hl-0">);</span><br/><span class="hl-0">  </span><span class="hl-5">ctx</span><span class="hl-0">.</span><span class="hl-5">xray</span><span class="hl-0">.</span><span class="hl-3">addMetadata</span><span class="hl-0">(</span><span class="hl-4">&quot;mySecondsNamespace&quot;</span><span class="hl-0">, </span><span class="hl-4">&quot;foo&quot;</span><span class="hl-0">, </span><span class="hl-4">&quot;bar&quot;</span><span class="hl-0">);</span><br/><br/><span class="hl-0">  </span><span class="hl-5">ctx</span><span class="hl-0">.</span><span class="hl-5">body</span><span class="hl-0"> = </span><span class="hl-4">&quot;Hi AWS, I&#39;m not using your SDK! =)&quot;</span><span class="hl-0">;</span><br/><span class="hl-0">});</span><br/><br/><span class="hl-5">app</span><span class="hl-0">.</span><span class="hl-3">listen</span><span class="hl-0">(</span><span class="hl-6">3030</span><span class="hl-0">, () </span><span class="hl-1">=&gt;</span><span class="hl-0"> </span><span class="hl-5">console</span><span class="hl-0">.</span><span class="hl-3">log</span><span class="hl-0">(</span><span class="hl-4">&quot;Listening at http://localhost:3030&quot;</span><span class="hl-0">));</span><br/>
</code></pre>

<a href="#how-to-use-without-any-web-framework" id="how-to-use-without-any-web-framework" style="color: inherit; text-decoration: none;">
  <h2>How to use without any web framework</h2>
</a>
<blockquote>
<p>You can change any aspect of your segment any time.</p>
</blockquote>
<pre><code class="language-javascript"><span class="hl-1">const</span><span class="hl-0"> </span><span class="hl-2">xrayWell</span><span class="hl-0"> = </span><span class="hl-3">require</span><span class="hl-0">(</span><span class="hl-4">&quot;xray-well&quot;</span><span class="hl-0">);</span><br/><span class="hl-1">const</span><span class="hl-0"> </span><span class="hl-3">sleep</span><span class="hl-0">    = (</span><span class="hl-5">ms</span><span class="hl-0">) </span><span class="hl-1">=&gt;</span><span class="hl-0"> </span><span class="hl-1">new</span><span class="hl-0"> </span><span class="hl-8">Promise</span><span class="hl-0">((</span><span class="hl-5">resolve</span><span class="hl-0">) </span><span class="hl-1">=&gt;</span><span class="hl-0"> </span><span class="hl-3">setTimeout</span><span class="hl-0">(</span><span class="hl-5">resolve</span><span class="hl-0">, </span><span class="hl-5">ms</span><span class="hl-0">));</span><br/><br/><span class="hl-1">async</span><span class="hl-0"> </span><span class="hl-1">function</span><span class="hl-0"> </span><span class="hl-3">init</span><span class="hl-0">() {</span><br/><span class="hl-0">  </span><span class="hl-7">// Create a main segment.</span><br/><span class="hl-0">  </span><span class="hl-1">const</span><span class="hl-0"> </span><span class="hl-2">segment</span><span class="hl-0"> = </span><span class="hl-5">xrayWell</span><span class="hl-0">.</span><span class="hl-5">segment</span><span class="hl-0">.</span><span class="hl-3">createSegment</span><span class="hl-0">(</span><span class="hl-4">&quot;my-own-function&quot;</span><span class="hl-0">);</span><br/><span class="hl-0">  </span><span class="hl-5">segment</span><span class="hl-0">.</span><span class="hl-5">annotations</span><span class="hl-0"> = {</span><br/><span class="hl-0">    </span><span class="hl-5">function:</span><span class="hl-0"> </span><span class="hl-4">&quot;init&quot;</span><span class="hl-0">,</span><br/><span class="hl-0">  };</span><br/><br/><span class="hl-0">  </span><span class="hl-7">// Submit main segment, in process yet.</span><br/><span class="hl-0">  </span><span class="hl-5">xrayWell</span><span class="hl-0">.</span><span class="hl-5">segment</span><span class="hl-0">.</span><span class="hl-3">submitSegmentPart</span><span class="hl-0">(</span><span class="hl-5">segment</span><span class="hl-0">);</span><br/><br/><span class="hl-0">  </span><span class="hl-9">await</span><span class="hl-0"> </span><span class="hl-3">sleep</span><span class="hl-0">(</span><span class="hl-6">1000</span><span class="hl-0">);</span><br/><br/><span class="hl-0">  </span><span class="hl-7">// Create a nested segment forked from main.</span><br/><span class="hl-0">  </span><span class="hl-1">const</span><span class="hl-0"> </span><span class="hl-2">nestedSegment</span><span class="hl-0"> = </span><span class="hl-5">xrayWell</span><span class="hl-0">.</span><span class="hl-5">segment</span><span class="hl-0">.</span><span class="hl-3">forkSegment</span><span class="hl-0">(</span><span class="hl-4">&quot;nestedSegment&quot;</span><span class="hl-0">, </span><span class="hl-5">segment</span><span class="hl-0">);</span><br/><span class="hl-0">  </span><span class="hl-5">nestedSegment</span><span class="hl-0">.</span><span class="hl-5">annotations</span><span class="hl-0"> = {</span><br/><span class="hl-0">    </span><span class="hl-5">function2:</span><span class="hl-0"> </span><span class="hl-4">&quot;doing something&quot;</span><span class="hl-0">,</span><br/><span class="hl-0">  };</span><br/><br/><span class="hl-0">  </span><span class="hl-7">// Submit my nested segment, in process yet.</span><br/><span class="hl-0">  </span><span class="hl-5">xrayWell</span><span class="hl-0">.</span><span class="hl-5">segment</span><span class="hl-0">.</span><span class="hl-3">submitSegmentPart</span><span class="hl-0">(</span><span class="hl-5">nestedSegment</span><span class="hl-0">);</span><br/><br/><span class="hl-0">  </span><span class="hl-9">await</span><span class="hl-0"> </span><span class="hl-3">sleep</span><span class="hl-0">(</span><span class="hl-6">1000</span><span class="hl-0">);</span><br/><br/><span class="hl-0">  </span><span class="hl-5">nestedSegment</span><span class="hl-0">.</span><span class="hl-5">annotations</span><span class="hl-0"> = {</span><br/><span class="hl-0">    </span><span class="hl-5">function2:</span><span class="hl-0"> </span><span class="hl-4">&quot;done of doing something&quot;</span><span class="hl-0">,</span><br/><span class="hl-0">  };</span><br/><br/><span class="hl-0">  </span><span class="hl-7">// Submit by nested segment already done.</span><br/><span class="hl-0">  </span><span class="hl-5">xrayWell</span><span class="hl-0">.</span><span class="hl-5">segment</span><span class="hl-0">.</span><span class="hl-3">submitSegment</span><span class="hl-0">(</span><span class="hl-5">nestedSegment</span><span class="hl-0">);</span><br/><br/><span class="hl-0">  </span><span class="hl-9">await</span><span class="hl-0"> </span><span class="hl-3">sleep</span><span class="hl-0">(</span><span class="hl-6">1000</span><span class="hl-0">);</span><br/><br/><span class="hl-0">  </span><span class="hl-7">// Submit my main segment to finish the flow.</span><br/><span class="hl-0">  </span><span class="hl-5">xrayWell</span><span class="hl-0">.</span><span class="hl-5">segment</span><span class="hl-0">.</span><span class="hl-3">submitSegment</span><span class="hl-0">(</span><span class="hl-5">segment</span><span class="hl-0">);</span><br/><span class="hl-0">}</span>
</code></pre>

<a href="#to-do" id="to-do" style="color: inherit; text-decoration: none;">
  <h2>TO-DO</h2>
</a>
<ul>
<li><input disabled="" type="checkbox"> Create an easy way to add SQL Segments;</li>
<li><input disabled="" type="checkbox"> Implement exceptions segments;</li>
<li><input disabled="" type="checkbox"> Complete documentation;</li>
</ul>

<a href="#license" id="license" style="color: inherit; text-decoration: none;">
  <h2>License</h2>
</a>
<p>  <a href="LICENSE">MIT</a></p>
</div></div><div class="col-4 col-menu menu-sticky-wrap menu-highlight"><nav class="tsd-navigation primary"><ul><li class="current"><a href="modules.html">Exports</a></li><li class=" tsd-kind-namespace"><a href="modules/_internal_.html">&lt;internal&gt;</a></li></ul></nav><nav class="tsd-navigation secondary menu-sticky"><ul><li class="tsd-kind-variable"><a href="modules.html#daemon" class="tsd-kind-icon">daemon</a></li><li class="tsd-kind-variable"><a href="modules.html#middleware" class="tsd-kind-icon">middleware</a></li><li class="tsd-kind-variable"><a href="modules.html#segment" class="tsd-kind-icon">segment</a></li><li class="tsd-kind-function"><a href="modules.html#activeUptime" class="tsd-kind-icon">active<wbr/>Uptime</a></li><li class="tsd-kind-function"><a href="modules.html#setConfig" class="tsd-kind-icon">set<wbr/>Config</a></li></ul></nav></div></div></div><footer class=""><div class="container"><h2>Settings</h2><p>Theme <select id="theme"><option value="os">OS</option><option value="light">Light</option><option value="dark">Dark</option></select></p></div></footer><div class="overlay"></div><script src="assets/main.js"></script></body></html>